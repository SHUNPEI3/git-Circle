<div class="container py-5">
  <%= render "public/shared/error_messages", resource: @end_user %>
  <div class="row m-4">
    <h3><i class="fas fa-pen"></i>&nbsp;ユーザー情報変更</h3>
  </div>
  <%= form_with model:@end_user, url: end_user_path(@end_user), methd: :patch do |f| %>
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <div class="col text-center">
          <% if @end_user.profile_image.attached? %>
            <div><%= image_tag @end_user.profile_image, size: "400x400", class:"img-thumbnail", id:'preview' %></div>
          <% else %>
            <div><%= image_tag asset_path('no_image'), size: "400x400" %></div>
          <% end %>
          <%= f.label :profile_image do %>
            <p class="text-primary"><i class="fas fa-camera"></i>&nbsp;画像を選択する</p>
            <%= f.file_field :profile_image, accept:'image/*', style:"display:none;", onchange: "previewImage(this)" %>
          <% end %>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <small><%= f.label :last_name, "姓" %><span class="badge badge-danger ml-2">必須</span></small><%= f.text_field :last_name, autofocus: true, placeholder:"田中", class:"form-control" %>
          </div>
          <div class="form-group col-md-6">
            <small><%= f.label :first_name, "名" %><span class="badge badge-danger ml-2">必須</span></small><%= f.text_field :first_name, placeholder:"太郎", class:"form-control" %>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <small><%= f.label :last_name_kana, "セイ" %><span class="badge badge-danger ml-2">必須</span></small><%= f.text_field :last_name_kana, placeholder:"タナカ", class:"form-control" %>
          </div>
          <div class="form-group col-md-6">
            <small><%= f.label :first_name_kana, "メイ" %><span class="badge badge-danger ml-2">必須</span></small><%= f.text_field :first_name_kana, placeholder:"タロウ", class:"form-control" %>
          </div>
        </div>

        <div class="form-group">
          <small><%= f.label :nickname, "ニックネーム", class:"col-form-label" %><span class="badge badge-danger ml-2">必須</span></small>
          <%= f.text_field :nickname, placeholder:"ニックネームを入力", class:"form-control" %>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <small><%= f.label :age, "年齢", class:"col-form-label" %><span class="badge badge-danger ml-2">必須</span></small>
            <%= f.select :age, (18..100).to_a, {}, class:"d-inline form-control", style:"width:100%" %>
          </div>
          <div class="form-group col-md-6">
            <small><%= f.label :sex, "性別", class:"col-form-label" %><span class="badge badge-danger ml-2">必須</span></small>
            <%= f.select :sex, EndUser.sexes_i18n.invert, {}, class:"form-control", style:"width:100%" %>
          </div>
        </div>
        <div class="form-group">
          <small><%= f.label :activity_area, "主な活動エリア", class:"col-form-label" %><span class="badge badge-danger ml-2">必須</span></small>
          <%= f.select :activity_area, EndUser.activity_areas_i18n.invert, {}, class:"form-control", style:"width:70%" %>
        </div>

        <div class="form-group">
          <small><%= f.label :email, "メールアドレス", class:"col-form-label" %><span class="badge badge-danger ml-2">必須</span></small>
          <%= f.email_field :email, autocomplete: "email", placeholder:"sample@sample.com", class:"form-control" %>
        </div>

        <div class="form-group">
          <small><%= f.label :introduction, "自己紹介", class:"col-form-label" %></small>
          <%= f.text_area :introduction, rows:"8", class:"form-control" %>
        </div>

        <div class="form-group">
          <small><%= f.label :personal_tag_name, "パーソナルタグ", class:"col-form-label" %></small>
          <%= f.text_field :personal_tag_name, value: @tag_list, class:"form-control" %>
          <small> ※半角スペースを入力することで、複数のタグを付けることができます</small>
         </div>

        <div class="row justify-content-center">
          <%= f.submit "変更を保存する", class:"btn btn-info mx-5 my-2 py-2", style:"width:45%" %>
          <%= link_to "退会する", unsubscribe_end_user_path(@end_user), class: "btn btn-secondary mx-5 my-2 py-2" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<script>
 function previewImage(obj)
  {
    var fileReader = new FileReader();
    fileReader.onload = function() {
    var element = document.getElementById('preview');
    element.src = fileReader.result;
    }
    fileReader.readAsDataURL(obj.files[0]);
  };
</script>