<div class="container">
  <div class="row m-4">
    <h2>"<%= @content %>"の検索結果</h2>
  </div>

  <% if @model == "end_user" %>
    <div class="row">
      <table class="table">
        <thead>
          <tr>
            <th class="col-md-2 text-center">ニックネーム</th>
            <th class="col-md-2">マイタグ</th>
            <th class="col-md-6">自己紹介</th>
            <th class="col-md-2"></th>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |user| %>
            <% unless user.guest_user? || !user.active_for_authentication? %>
              <tr>
                <td class="align-middle text-center">
                  <%= link_to end_user_path(user.id) do %>
                    <%= image_tag user.get_profile_image(50, 50), class: "rounded-circle" %><br>
                    <%= user.nickname %>
                  <% end %>
                </td>
                <td class="align-middle">
                  <% user.personal_tags.each do |tag| %>
                    <li class="list-unstyled"><%= "#" + tag.name %></li>
                  <% end %>
                </td>
                <td class="align-middle"><%= user.introduction.truncate(35) %></td>
                <td class="align-middle">
                  <% unless current_end_user.guest_user? || current_end_user == user %>
                    <% if user.followed_by?(current_end_user) %>
                      <%=link_to "フォロー中", end_user_relationships_path(user.id), method: :delete, class: "btn btn-light", style:"width: 100%"  %>
                    <% else %>
                      <%=link_to "フォローする", end_user_relationships_path(user.id), method: :post, class: "btn btn-primary", style:"width: 100%" %>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>

  <% elsif @model == "personal_tag" %>
    <div class="row">
      <table class="table">
        <thead>
          <tr>
            <th class="text-center" style="width: 15%">ニックネーム</th>
            <th style="width: 15%">マイタグ</th>
            <th style="width: 50%">自己紹介</th>
            <th style="width: 20%"></th>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |tag| %>
            <% tag.end_users.each do |user| %>
              <% if user.active_for_authentication? %>
                <tr>
                  <td class="align-middle text-center">
                    <%= link_to end_user_path(user.id) do %>
                      <%= image_tag user.get_profile_image(50, 50), class: "rounded-circle" %><br>
                      <%= user.nickname %>
                    <% end %>
                  </td>
                  <td class="align-middle"><%= "#" + tag.name %></td>
                  <td class="align-middle"><%= user.introduction.truncate(35) %></td>
                  <td class="align-middle">
                    <% unless current_end_user.guest_user? || current_end_user == user %>
                      <% if user.followed_by?(current_end_user) %>
                        <%= link_to "フォロー中", end_user_relationships_path(user.id), method: :delete, class: "btn btn-light", style:"width: 100%"  %>
                      <% else %>
                        <%= link_to "フォローする", end_user_relationships_path(user.id), method: :post, class: "btn btn-primary", style:"width: 100%" %>
                      <% end %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>

  <% elsif @model == "community" %>
    <div class="row">
      <table class="table">
        <thead>
          <tr>
            <th class="text-center" style="width: 15%">コミュニティ名</th>
            <th style="width: 15%">コミュニティタグ</th>
            <th style="width: 50%">紹介文</th>
            <th style="width: 20%">メンバー</th>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |community| %>
            <tr>
              <td class="align-middle text-center">
                <%= link_to community_path(community.id) do %>
                  <%= image_tag community.get_community_image(100, 100), class: "rounded-circle" %><br>
                  <%= community.name %>
                <% end %>
              </td>
              <td class="align-middle">
                <% community.tags.each do |tag| %>
                  <li class="list-unstyled"><%= "#" + tag.name %></li>
                <% end %>
              </td>
              <td class="align-middle"><%= community.introduction.truncate(35) %></td>
              <td class="align-middle">
                <% community.end_users.each do |member| %>
                  <% if member.active_for_authentication? %>
                    <li class="list-unstyled">
                      <%= link_to "#{member.nickname}", end_user_path(member.id) %>
                    </li>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  <% elsif @model == "community_tag" %>
    <div class="row">
      <table class="table">
        <thead>
          <tr>
            <th class="text-center" style="width: 15%">コミュニティ名</th>
            <th style="width: 15%">コミュニティタグ</th>
            <th style="width: 50%">紹介文</th>
            <th style="width: 20%">メンバー</th>
          </tr>
        </thead>
        <tbody>
          <% @records.each do |tag| %>
            <% tag.communitys.each do |community| %>
                <tr>
                  <td class="align-middle text-center">
                    <%= link_to community_path(community.id) do %>
                      <%= image_tag community.get_community_image(100, 100), class: "rounded-circle" %><br>
                      <%= community.name %>
                    <% end %>
                  </td>
                  <td class="align-middle"><%= "#" + tag.name %></td>
                  <td class="align-middle"><%= community.introduction.truncate(35) %></td>
                  <td class="align-middle">
                    <% community.end_users.each do |member| %>
                      <% if member.active_for_authentication? %>
                        <li class="list-unstyled">
                          <%= link_to "#{member.nickname}", end_user_path(member.id) %>
                        </li>
                      <% end %>
                    <% end %>
                  </td>
                </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>

  <% end %>

</div>
