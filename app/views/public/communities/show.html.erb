<div class="container pb-5">
  <div class="row m-4">
    <h3><i class="fas fa-object-group"></i>&nbsp;コミュニティ詳細</h3>
  </div>
  <div class="row justify-content-around">
    <div class="col-md-4 col-sm-12 mb-3">
      <div class="row justify-content-center">
        <div>
          <%= image_tag @community.get_community_image(220, 220), class:"img-thumbnail" %>
          <% unless current_end_user.guest_user? %>
            <div class="text-center py-2", style="width:230px" >
              <% if @community.owner_id == current_end_user.id %>
                <%= form_with model: @community, url: community_invitation_path(@community.id), method: :post do |f| %>
                  <%= f.label :user_id, 'フォローユーザーを招待する' %>
                  <%= f.select :user_id, options_from_collection_for_select(@other_users, :id, :nickname), {include_blank: "選択してください"}, class:"form-control mt-1" %>
                  <%= f.submit "招待する", class:"btn btn-warning text-light mt-2 py-1", style:"width: 100%" %>
                <% end %>
              <% elsif @community.already_joined?(current_end_user) %>
                <%= link_to '退出する', community_community_users_path(@community), method: :delete, data: {confirm: "本当に退出しますか？"}, class: "btn btn-danger", style:"width: 100%" %>
              <% else %>
                <%= link_to '参加する', community_community_users_path(@community), method: :post, class: "btn btn-info", style:"width: 100%" %>
              <% end %>
            </div>
          <% end %>
        </div>
        <div class="border", style="width: 230px" >
          <h6 class="font-weight-bold m-3">リーダー</h6>
          <%= link_to end_user_path(@community.owner) do %>
            <%= image_tag @community.owner.get_profile_image(60, 60), class:"img-thumbnail rounded-circle mx-3" %>
            <span class="text-info"><%= @community.owner.nickname %></span>
          <% end %>
          <h6 class="m-3">メンバー</h6>
          <% @community.end_users.each do |member| %>
            <% unless !member.active_for_authentication? || @community.owner == member %>
              <li style="list-style: none;">
                <%= link_to end_user_path(member) do %>
                  <%= image_tag member.get_profile_image(60, 60), class:"img-thumbnail rounded-circle mx-3 mb-2" %>
                  <span class="text-info"><%= member.nickname %></span>
                <% end %>
              </li>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-md-7">
      <h1 class="font-weight-bold"><%= @community.name %></h1>
      <div class="card mt-3 mb-4">
        <div class="card-header">
          <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
              <a href="#contents1" class="nav-link active text-dark" data-toggle="tab">コミュニティ紹介</a>
            </li>
            <li class="nav-item">
              <a href="#contents2" class="nav-link text-dark" data-toggle="tab">参加条件</a>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content">
            <div id="contents1" class="tab-pane active p-2">
              <h5 class="font-weight-bold"><%= safe_join(@community.introduction.split("\n"), tag(:br)) %></h5>
              <p class="mt-3">メンバー数：<%= @community.end_users.count %>人</p>
              <p class="">設立日：<%= @community.created_at.strftime("%Y/%m/%d") %></p>
               <i class="fas fa-tag mr-2"></i>
               <% @community.tags.each do |community_tag| %>
                 <%= link_to "#{"#" + community_tag.name}", search_community_tag_community_path(community_tag), class:"mr-1" %>
               <% end %>
              <div class="row justify-content-end mr-3">
                <% if @community.owner_id == current_end_user.id %>
                  <%= link_to '＋コミュニティ情報を編集する', edit_community_path(@community), class: "btn btn-info mt-2", style:"" %>
                <% end %>
              </div>
            </div>
            <div id="contents2" class="tab-pane">
              <% @community.community_details.each do |detail| %>
                <% if detail.max_join_number? %>
                  <li class="my-2">参加人数は「<span class="font-weight-bold text-warning"><%= detail.max_join_number %>人</span>」まで&nbsp;（現在<%= @community.end_users.count %>人参加中）</li>
                <% end %>
                <% if detail.sex_limit? %>
                  <li class="my-2"><span class="font-weight-bold text-warning"><%= detail.sex_limit_i18n %></span></li>
                <% end %>
                <% if detail.activity_area_limit? %>
                  <li class="my-2">主な活動エリアが「<span class="font-weight-bold text-warning"><%= detail.activity_area_limit_i18n %></span>」の人</li>
                <% end %>
                <% if detail.age_min_limit || detail.age_max_limit %>
                  <li class="my-2">年齢が「<span class="font-weight-bold text-warning"><%= detail.age_min_limit %>歳〜<%= detail.age_max_limit %>歳</span>」の人</li>
                <% end %>
              <% end %>
              <div class="row justify-content-end mr-3">
                <% if @community.owner_id == current_end_user.id %>
                  <%= link_to '＋参加条件を変更する', edit_community_path(@community), class: "btn btn-info mt-2", style:"" %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-between">
        <h3 class="">新着トピックス</h3>
        <%= link_to 'もっと見る >>', community_topics_path(@community), class:"mt-3" %>
      </div>
      <div class="border"></div>
      <% @topics.each do |topic| %>
        <% if topic.end_user.active_for_authentication? %>
          <div class="d-flex justify-content-between mt-3">
            <h5 class=""><i class="far fa-flag"></i>&nbsp;&nbsp;&nbsp;<%= link_to topic.title.truncate(20), community_topic_path(topic.community,topic) %></h5>
            <p><small><%= topic.created_at.strftime("%Y/%m/%d\ %R") %>&nbsp;投稿</small></p>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>














